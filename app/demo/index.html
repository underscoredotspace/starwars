<html data-ng-app="demoApp">
  <head>
    <title>Star Wars</title>
  </head>
  
  <body>
    <data-ng-view></data-ng-view>
    
    <script src="/angular/angular.min.js"></script>
    <script src="/angular-route/angular-route.min.js"></script>
    <script src="dotSpace.starWars.js"></script>
    <script>
      (function() {
        angular.module('demoApp', ['dotSpace.starWars', 'ngRoute'])

        .config(router)
          router.$inject = ['$routeProvider']

          function router($routeProvider) {
            $routeProvider
            .when('/res/:resource', {
              redirectTo: '/res/:resource/1'
            })
            .when('/res/:resource/:page', {
              templateUrl: 'parts/resource-part.html',
              controller: 'resourceController as resource'
            })
            .when('/res/:resource/search/:searchString', {
              redirectTo: '/res/:resource/search/:searchString/1'
            })
            .when('/res/:resource/search/:searchString/:page', {
              templateUrl: 'parts/resource-part.html',
              controller: 'resourceController as resource'
            })
            .otherwise({redirectTo:'/res/planets'})
          }
      })();

      (function() {

        angular.module('demoApp')
        .controller('resourceController', resourceController)
          resourceController.$inject = ['swapiService', '$routeParams']
          
          function resourceController (swapiService, $routeParams) {
            const vm = this
            vm.resource = $routeParams.resource
            let options = {}
            let searchPath = ''

            if (angular.isDefined($routeParams.searchString)) {
              options = angular.extend({}, options, {searchString:$routeParams.searchString})
              searchPath = `search/${$routeParams.searchString}/`
            }

            if (angular.isDefined($routeParams.page)) {
              vm.page = Number($routeParams.page)
              options = angular.extend({}, options, {page:vm.page})
              vm.next = `/#!/res/${vm.resource}/${searchPath}${vm.page+1}`
              vm.previous = `/#!/res/${vm.resource}/${searchPath}${vm.page-1}`
            }

            swapiService.get(vm.resource, options)
            .then(resource => {vm.data = resource})
            .catch(err => alert(err.statusText))
          }
      })();
    </script>
  </body>
</html>